=============================
=============================
Setting up you own Room-House
=============================
=============================


Prerequisites
=============

1. A 64-bit CPU (x86-64, Intel or AMD); if other CPUs are possible, see support on VirtualBox site.
2. 5G or more of unused RAM (normally it means 6G or more of total RAM).
3. Static IP4 on your Internet router.


Pre-installation
================

1. Check that Virtualization is enabled in your BIOS.
2. Check that Hyper-V (Windows only) is NOT running.


Installation
============

1. Download the latest VirtualBox for your OS from https://www.virtualbox.org/wiki/Downloads

2. Run the installation of VirtualBox to its default Windows location:"C:\Program Files\Oracle\VirtualBox"


In case you're on a different OS like Linux, the rest of this is true, too. 

A shortcut of all the commands in one awesome script for you:


https://github.com/kl3eo/room-house/blob/main/VM_create_RH_only.sh


Setup xTER VM
=============

Open the command line (terminal) - it usually prompts to "C:\Users\Bob" - if you're a User named Bob.

Set a correct PATH to the VirtualBox binary files:


set PATH=%PATH%;"C:\Program Files\Oracle\VirtualBox"


Now, check that Windows understands the "VBoxManage" command - type "VBoxManage" in the terminal and see the output.

If Windows doesn't understand this command, this link explains why not:


https://www.roelpeters.be/vboxmanage-is-not-recognized-and-how-to-solve-it/


If you have installed VirtualBox in a different folder, don't forget to set a correct PATH in the terminal before running the rest of this setup.

If Windows understands the "VBoxManage" command, and there is some old VM named "xTER", you may want to delete it:


VBoxManage unregistervm xTER --delete


If there is no folder "C:\Users\Bob\VMs", now make one:


mkdir "C:\Users\Bob\VMs"


Create a new VM named "xTER" of type "Linux Red Hat 64-bit":


1. VBoxManage createvm --name xTER --ostype RedHat_64 --register --basefolder "C:\Users\Bob\VMs"


There must have appeared a new folder - "C:\Users\Bob\VMs\xTER".

Change to this new directory:


cd "C:\Users\Bob\VMs\xTER"


Provide your new VM with minimum 5,120M of RAM, 1 or 2 CPU cores, no audio, with EFI, port forwarding and logging external request IPs.
If you can, increase the RAM size and # of CPU cores according to what is actually there on your host computer:


2. VBoxManage modifyvm xTER --memory 5120 --cpus 2 --audio none --firmware efi --nic1 nat --nataliasmode1 proxyonly


Setup internal host-to-guest port forwarding for the Room-House chat and to the HTTPS admin web interface:


3. VBoxManage modifyvm xTER --natpf1 "chat,tcp,,8443,,443" 
4. VBoxManage modifyvm xTER --natpf1 "admin,tcp,,8843,,8443"


Create a 2Gb disk for Room-House database, logs, etc:


5. VBoxManage createmedium --filename 2G.vdi --size 2000


Create a virtual SATA controller:


6. VBoxManage storagectl xTER --name SATA --add sata


Download our bootloader file "https://github.com/kl3eo/room-house/blob/main/loop.vdi" and put it to "C:\Users\Bob\VMs\xTER"
Attach this file to the VM as Disk 0:


7. VBoxManage storageattach xTER --storagectl SATA --medium loop.vdi --port 0 --type hdd


Attach the 2Gb file as Disk 1:


8. VBoxManage storageattach xTER --storagectl SATA --medium 2G.vdi --port 1 --type hdd


Add this directive to boot from Disk 0:


9. VBoxManage modifyvm xTER --boot1 disk --boot2 none --boot3 none --boot4 none


Boot and post-installation setup
================================

Now, boot the VM from VirtualBox graphical manager. You should see another window opening and xTER loading in it. 
After the xTER is fully loaded, you'll see a confirmation in this window.

== OR =================
If there is no graphical manager, like when you've done this setup on a remote host, continue to use command line.

Start the xTER boot from it with the command:
10. VBoxHeadless --startvm xTER

Warning: You will NOT see any output from the loading xTER in this case. 

Just wait a few minutes and check if you can open the admin web interface (see below).
--------------------------------------------------------------------------------------

See if you can open the admin web interface (WI) in your browser at https://localhost:8843

[ The rest of this setup is also covered in Help at https://xter.tech/vbhelp/index.html - go to p.17 and browse to the end. ]

If your browser complains that this site's certificate is "*.room-house.com", while you're trying to access it locally - that's correct. 

We will allow your computer be accessed on the right URL later, and this certificate will then be good for your new Room-House node.

Use the default login/password, if it is the first time you log in the web interface.

Don't forget to change the default admin password and "Save" it. See the Help file on the link given above about how you can do this in details. 


Check your Room-House node is usable
====================================

Before anything, you must do port forwarding on the Internet router to your host.

1. First, forward our standard external port for Room-House which is 443. 
You have to forward this port 443 on the router to port 8443 on your host machine. 
[ Which has an IP like 192.168.0.11 - or whatever, you know better. ]

2. Second, forward the port 8443 on your router to port 8843 on your host.
But make sure that you've changed the default admin password as we hope you already did! Only you must know it by now.

Now, it's time to check in the admin web interface (WI).

First, open the WI menu "Info" page, search for Disk Use and Memory Use columns. 

If you've setup this VM with a minimal amount of RAM available to it, then you'd be now with ~195K of free disk space and 5,060M of total memory. 

Check that this is indeed the case. 

If you'd allowed more RAM during setup, then of course there would be more disk space and more memory available now.

Now, look at the list of running processes in the same page below the middle line inside a wide container. Check that the KMS is running.

There must be a line ending with "kurento-media-server". If it's there, it's the first line on top.

Now, look at the bottom of the same container, there must be a very-very VERY long line containing hundreds of words, like "java", "spring", "guava", etc.

If it's there, congratulations, your node is running. 

If it's not there, maybe the node has not started automatically.

This is known to happen if your VM's CPU power is low.
 
In this case, hit "Restart KMS" button in the left column. 

Wait a few seconds, then you'll see your node is running.

If your RH node is NOT running, whatever, and an alert keeps telling you that there has been "a problem with your static IP", 
- maybe your external IP is dynamic, or maybe it's static but not visible from outside of your local net. 

Or, you've failed to forward the two ports (443 and 8443) on your router correctly - see again pp.1 and 2 in this Chapter. 

Check your router again to be sure the port forwarding is there and it's correct.

Also make sure that your external IP is static and not dynamic - contact your Internet provider and request for a static IP.

It is NOT possible to run an RH node on a dynamic IP, though it is ok to boot xTER and use the admin web interface.

Your RH node will also temporarily stop running when your external static IP becomes invisible from the outside. When this problem disappears,
so does the problem with the RH node - it's up and running again, automatically.

Now that your RH node is up and running, proceed to going public.


Going public
============

It's time we make your node visible to the world and after that you begin to earn coins for the Room-House traffic.

Use Twitter or Telegram and tell us what's your static IP.

Example: IP 81.13.45.90

We will add your node to our proxy servers so that it becomes visible to public.

And as soon as we add your node to the list on our proxies, we will inform you.


==========
==========

Good luck!

==========
==========
